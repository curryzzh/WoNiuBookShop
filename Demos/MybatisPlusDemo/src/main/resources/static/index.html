<!DOCTYPE html>
<html>
<head>
  <title>User Management</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container my-4">
  <h1>User Management</h1>
  <table class="table table-striped table-hover">
    <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Age</th>
      <th>Email</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#userFormModal">Add User</button>
</div>

<div class="modal fade" id="userFormModal" tabindex="-1" aria-labelledby="userFormModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="userForm">
        <div class="modal-header">
          <h5 class="modal-title" id="userFormModalLabel">User Form</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" name="name" required>
          </div>
          <div class="mb-3">
            <label for="age" class="form-label">Age</label>
            <input type="number" class="form-control" id="age" name="age" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  $(function() {
    var $table = $('table');
    var $tbody = $table.find('tbody');
    var $userForm = $('#userForm');
    var $userFormModal = $('#userFormModal');
    var $userFormModalLabel = $('#userFormModalLabel');
    var $userFormSubmitButton = $userForm.find('button[type="submit"]');
    var $userFormCancelButton = $userForm.find('button[type="button"]');
    var $userFormNameInput = $userForm.find('#name');
    var $userFormAgeInput = $userForm.find('#age');
    var $userFormEmailInput = $userForm.find('#email');

    function loadUsers() {
      axios.get('/user/list')
              .then(function(response) {
                $tbody.empty();
                $.each(response.data, function(i, user) {
                  var $tr = $('<tr>');
                  $tr.append($('<td>').text(user.id));
                  $tr.append($('<td>').text(user.name));
                  $tr.append($('<td>').text(user.age));
                  $tr.append($('<td>').text(user.email));
                  var $actionsTd = $('<td>');
                  var $editButton = $('<button>').addClass('btn btn-primary me-2').text('Edit');
                  $editButton.click(function() {
                    $userFormModalLabel.text('Edit User');
                    $userFormSubmitButton.text('Update');
                    $userFormNameInput.val(user.name);
                    $userFormAgeInput.val(user.age);
                    $userFormEmailInput.val(user.email);
                    $userForm.attr('action', '/user/update?id=' + user.id);
                    $userFormModal.modal('show');
                  });
                  var $deleteButton = $('<button>').addClass('btn btn-danger').text('Delete');
                  $deleteButton.click(function() {
                    if (confirm('Are you sure you want to delete ' + user.name + '?')) {
                      axios.delete('/user/delete?id=' + user.id)
                              .then(function() {
                                loadUsers();
                              });
                    }
                  });
                  $actionsTd.append($editButton);
                  $actionsTd.append($deleteButton);
                  $tr.append($actionsTd);
                  $tbody.append($tr);
                });
              });
    }

    $userForm.submit(function(event) {
      event.preventDefault();
      var url = $userForm.attr('action') || '/user/create';
      var method = $userForm.attr('method') || 'POST';
      var data = $userForm.serialize();
      axios({
        method: method,
        url: url,
        data: data,
      })
              .then(function() {
                $userFormModal.modal('hide');
                loadUsers();
              });
    });

    $userFormCancelButton.click(function() {
      $userFormModal.modal('hide');
    });

    loadUsers();
  });
</script>
</body>
</html>